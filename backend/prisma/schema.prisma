// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER MANAGEMENT
// ============================================

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  username  String   @unique
  password  String

  // Profile
  displayName String?
  avatar      String?
  bio         String?

  // Gamification Stats
  level       Int      @default(1)
  xp          Int      @default(0)
  health      Int      @default(50)
  maxHealth   Int      @default(50)
  gold        Int      @default(0)
  gems        Int      @default(0)
  streak      Int      @default(0)

  // Attributes (RPG-style)
  strength     Int @default(0)
  intelligence Int @default(0)
  constitution Int @default(0)
  perception   Int @default(0)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  lastActive DateTime @default(now())

  // Relations
  habits                Habit[]
  dailyTasks            DailyTask[]
  completions           HabitCompletion[]
  userQuests            UserQuest[]
  achievements          UserAchievement[]
  streakHistory         StreakHistory[]
  householdMembers      HouseholdMember[]
  ownedHouseholds       Household[]               @relation("HouseholdOwner")
  requestedFavors       FavorTransaction[]        @relation("RequestedFavors")
  assignedFavors        FavorTransaction[]        @relation("AssignedFavors")
  choreAssignments      ChoreAssignment[]
  announcements         Announcement[]
  announcementReactions AnnouncementReaction[]
  notifications         Notification[]
  notificationPreferences NotificationPreference?
  pushSubscriptions     PushSubscription[]

  // Sprint 6 Relations
  taskHistory           TaskHistory[]
  createdTemplates      RoomTemplate[]
  bulkOperations        BulkOperation[]

  @@map("users")
}

// ============================================
// HABIT TRACKING
// ============================================

enum HabitType {
  POSITIVE  // Good habits to build (e.g., exercise, study)
  NEGATIVE  // Bad habits to break (e.g., smoking, procrastination)
  DAILY     // Daily tasks/chores
}

enum HabitFrequency {
  DAILY
  WEEKLY
  CUSTOM
}

model Habit {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Habit Details
  title       String
  description String?
  icon        String?
  color       String?

  // Type & Settings
  type        HabitType        @default(POSITIVE)
  frequency   HabitFrequency   @default(DAILY)
  difficulty  Int              @default(1) // 1-5 (affects XP rewards)

  // Rewards
  xpReward    Int              @default(10)
  goldReward  Int              @default(5)
  healthCost  Int              @default(0) // For negative habits

  // Tracking
  currentStreak Int            @default(0)
  longestStreak Int            @default(0)
  totalCompletions Int         @default(0)

  // Schedule
  isActive    Boolean          @default(true)
  startDate   DateTime         @default(now())
  endDate     DateTime?

  // Timestamps
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  // Relations
  completions HabitCompletion[]

  @@map("habits")
  @@index([userId])
}

model HabitCompletion {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  habitId     String
  habit       Habit    @relation(fields: [habitId], references: [id], onDelete: Cascade)

  // Completion Details
  completedAt DateTime @default(now())
  date        DateTime @default(now()) @db.Date
  notes       String?

  // Rewards Earned
  xpEarned    Int      @default(0)
  goldEarned  Int      @default(0)

  @@map("habit_completions")
  @@unique([habitId, date])
  @@index([userId])
  @@index([date])
}

// ============================================
// DAILY TASKS
// ============================================

model DailyTask {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Task Details
  title       String
  description String?

  // Completion
  isCompleted Boolean  @default(false)
  completedAt DateTime?
  dueDate     DateTime @db.Date

  // Rewards
  xpReward    Int      @default(5)
  goldReward  Int      @default(2)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("daily_tasks")
  @@index([userId])
  @@index([dueDate])
}

// ============================================
// DAILY QUESTS
// ============================================

enum QuestType {
  HABIT_COMPLETION    // Complete X habits
  STREAK_BUILD        // Build/maintain streak
  SPECIFIC_HABIT      // Complete specific habit
  SOCIAL              // Help family member
  CUSTOM              // Custom requirements
}

model Quest {
  id          String    @id @default(uuid())

  // Quest Details
  key         String    @unique // e.g., "complete_3_habits", "maintain_streak"
  title       String
  description String
  icon        String?

  // Quest Type & Requirements
  type        QuestType
  category    String    @default("daily") // "daily", "weekly", "special"
  targetCount Int       @default(1)       // How many to complete

  // Rewards
  xpReward    Int       @default(20)
  goldReward  Int       @default(10)
  gemsReward  Int       @default(0)

  // Settings
  isActive    Boolean   @default(true)
  isDaily     Boolean   @default(true)
  difficulty  Int       @default(1)       // 1-3 (easy, medium, hard)

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  userQuests  UserQuest[]

  @@map("quests")
}

model UserQuest {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  questId     String
  quest       Quest    @relation(fields: [questId], references: [id], onDelete: Cascade)

  // Progress
  progress    Int      @default(0)
  isCompleted Boolean  @default(false)
  completedAt DateTime?

  // Daily reset tracking
  assignedDate DateTime @db.Date
  expiresAt    DateTime

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("user_quests")
  @@unique([userId, questId, assignedDate])
  @@index([userId])
  @@index([assignedDate])
  @@index([isCompleted])
}

// ============================================
// GAMIFICATION
// ============================================

model Achievement {
  id          String   @id @default(uuid())

  // Achievement Details
  key         String   @unique // e.g., "first_habit", "streak_7", "level_10"
  name        String
  description String
  icon        String?

  // Requirements
  category    String   // e.g., "habits", "streaks", "levels"
  requirement Int      // e.g., 7 for streak_7

  // Rewards
  xpReward    Int      @default(0)
  goldReward  Int      @default(0)
  gemsReward  Int      @default(0)

  // Timestamps
  createdAt   DateTime @default(now())

  // Relations
  users       UserAchievement[]

  @@map("achievements")
}

model UserAchievement {
  id            String      @id @default(uuid())
  userId        String
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievementId String
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  // Unlock Details
  unlockedAt    DateTime    @default(now())
  progress      Int         @default(0)

  @@map("user_achievements")
  @@unique([userId, achievementId])
  @@index([userId])
}

model StreakHistory {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Streak Details
  date        DateTime @db.Date
  streakCount Int

  @@map("streak_history")
  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}

// ============================================
// HOUSEHOLD / FAMILY
// ============================================

enum HouseholdRole {
  OWNER
  ADMIN
  MEMBER
}

// Dunbar's Layers: Household size tiers based on human-scale community research
enum HouseholdSizeTier {
  SMALL    // 2-7 members: Intimate friends layer (highest trust)
  MEDIUM   // 8-20 members: Best friends layer (very high trust)
  LARGE    // 21-68 members: Good friends layer (optimal for cooperation)
  CLAN     // 69-200 members: Casual friends layer (requires governance)
}

// Household trust development stages (Tuckman's model)
enum HouseholdStage {
  FORMING     // Week 1-2: Getting to know each other
  STORMING    // Week 3-6: Conflicts and norm negotiation
  NORMING     // Week 7-12: Shared expectations emerge
  PERFORMING  // Month 4+: High trust, seamless collaboration
}

model Household {
  id          String   @id @default(uuid())

  // Household Details
  name        String
  description String?
  avatar      String?
  inviteCode  String   @unique @default(uuid())

  // Size Configuration (Dunbar's Layers)
  sizeTier    HouseholdSizeTier @default(LARGE)
  maxMembers  Int      @default(65)  // Default to optimal "good friends" layer
  memberCount Int      @default(0)   // Cached count for performance

  // Trust Development
  stage       HouseholdStage @default(FORMING)
  healthScore Int      @default(50)  // 0-100 health metric

  // Settings
  isActive    Boolean  @default(true)

  // Owner
  ownerId     String
  owner       User     @relation("HouseholdOwner", fields: [ownerId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  members        HouseholdMember[]
  transactions   FavorTransaction[]
  choreTemplates ChoreTemplate[]
  announcements  Announcement[]
  rooms          Room[]

  // Sprint 6 Relations
  categories     TaskCategory[]
  tags           Tag[]
  bulkOperations BulkOperation[]

  @@map("households")
  @@index([ownerId])
  @@index([inviteCode])
  @@index([sizeTier])
  @@index([stage])
}

model HouseholdMember {
  id           String        @id @default(uuid())
  householdId  String
  household    Household     @relation(fields: [householdId], references: [id], onDelete: Cascade)
  userId       String
  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Member Details
  role         HouseholdRole @default(MEMBER)
  nickname     String?
  
  // Stats
  contribution Int           @default(0) // Total contribution points
  
  // Timestamps
  joinedAt     DateTime      @default(now())
  
  @@map("household_members")
  @@unique([householdId, userId])
  @@index([householdId])
  @@index([userId])
}

// ============================================
// LETS (Local Exchange Trade System)
// ============================================

enum TransactionStatus {
  PENDING
  ACCEPTED
  COMPLETED
  DECLINED
  CANCELLED
}

// Trust levels for favors based on Dunbar's Layers
enum TrustLevel {
  LOW     // 1-10 credits: Casual friends, strangers (low risk)
  MEDIUM  // 10-50 credits: Good friends (moderate commitment)
  HIGH    // 50-200 credits: Best/intimate friends (high vulnerability)
}

model FavorTransaction {
  id             String            @id @default(uuid())
  householdId    String
  household      Household         @relation(fields: [householdId], references: [id], onDelete: Cascade)

  // Who needs the favor
  requesterId    String
  requester      User              @relation("RequestedFavors", fields: [requesterId], references: [id], onDelete: Cascade)

  // Who will do the favor (can be null for open requests)
  assigneeId     String?
  assignee       User?             @relation("AssignedFavors", fields: [assigneeId], references: [id], onDelete: Cascade)

  // Task Details
  title          String
  description    String?
  credits        Int               @default(10) // Favor credits for this task

  // Trust Level (automatically set based on credits)
  trustLevel     TrustLevel        @default(LOW)

  // Status
  status         TransactionStatus @default(PENDING)

  // Timestamps
  createdAt      DateTime          @default(now())
  acceptedAt     DateTime?
  completedAt    DateTime?

  @@map("favor_transactions")
  @@index([householdId])
  @@index([requesterId])
  @@index([assigneeId])
  @@index([status])
  @@index([trustLevel])
}

// ============================================
// ROOMS & SPATIAL ORGANIZATION
// ============================================

enum RoomType {
  KITCHEN
  LIVING_ROOM
  BEDROOM
  BATHROOM
  DINING_ROOM
  HOME_OFFICE
  LAUNDRY_ROOM
  GARAGE
  BACKYARD
  ENTRYWAY
  STORAGE
  CUSTOM
}

model Room {
  id          String   @id @default(uuid())
  householdId String
  household   Household @relation(fields: [householdId], references: [id], onDelete: Cascade)

  // Room Details
  name        String
  type        RoomType @default(CUSTOM)
  icon        String   @default("üè†")
  description String?

  // Gamification
  xp          Int      @default(0)
  level       Int      @default(1)

  // Order & Display
  order       Int      @default(0)
  isActive    Boolean  @default(true)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  choreTemplates ChoreTemplate[]
  taskPresets    TaskPreset[]

  @@map("rooms")
  @@index([householdId])
  @@index([type])
}

// ============================================
// TASK PRESETS (150+ Templates)
// ============================================

enum PresetFrequency {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  SEASONAL
  YEARLY
  AS_NEEDED
}

enum PresetCategory {
  CLEANING
  ORGANIZING
  MAINTENANCE
  COOKING
  LAUNDRY
  OUTDOOR
  PETS
  PLANTS
  GENERAL
}

model TaskPreset {
  id          String   @id @default(uuid())

  // Preset Details
  title       String
  description String?
  icon        String   @default("‚úÖ")

  // Categorization
  roomType    RoomType
  category    PresetCategory @default(CLEANING)

  // Recommended Settings
  frequency   PresetFrequency @default(WEEKLY)
  difficulty  Int      @default(1) // 1-5
  estimatedMinutes Int @default(15)

  // Gamification
  xpReward    Int      @default(10)
  goldReward  Int      @default(5)

  // System vs User-Created
  isSystemPreset Boolean @default(true)
  roomId      String?
  room        Room?    @relation(fields: [roomId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("task_presets")
  @@index([roomType])
  @@index([category])
  @@index([isSystemPreset])
}

// ============================================
// CHORE ROTATION SYSTEM
// ============================================

enum ChoreFrequency {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
}

model ChoreTemplate {
  id            String        @id @default(uuid())
  householdId   String
  household     Household     @relation(fields: [householdId], references: [id], onDelete: Cascade)

  // Room Assignment
  roomId        String?
  room          Room?         @relation(fields: [roomId], references: [id], onDelete: SetNull)

  // Chore Details
  title         String
  description   String?
  icon          String?       @default("üßπ")

  // Difficulty & Time
  difficulty    Int           @default(1)      // 1-5
  estimatedTime Int?                           // minutes

  // Rewards
  xpReward      Int           @default(20)
  goldReward    Int           @default(10)
  letsCredit    Int           @default(5)      // LETS credits for completion

  // Settings
  frequency     ChoreFrequency @default(WEEKLY)
  photoRequired Boolean       @default(false)
  isActive      Boolean       @default(true)

  // Scheduling (Sprint 5B)
  scheduledAt    DateTime?                     // When task is scheduled to start
  dueDate        DateTime?                     // When task should be completed
  recurrence     String?       @default("none") // 'none', 'daily', 'weekly', 'monthly'
  recurrenceData Json?                         // { interval: 1, daysOfWeek: [1,3,5] }
  timezone       String?       @default("America/Mexico_City") // Timezone for scheduling

  // Status Tracking (Sprint 5B)
  status         String        @default("pending") // 'pending', 'in_progress', 'completed', 'overdue'
  completedAt    DateTime?                     // When task was completed

  // Recurrence Relations (Sprint 5B)
  parentTaskId   String?
  parentTask     ChoreTemplate? @relation("TaskRecurrence", fields: [parentTaskId], references: [id], onDelete: SetNull)
  childTasks     ChoreTemplate[] @relation("TaskRecurrence")

  // Timestamps
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  // Relations
  assignments   ChoreAssignment[]

  // Sprint 6 Relations
  categoryId    String?
  category      TaskCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  tags          TaskTag[]
  history       TaskHistory[]

  @@map("chore_templates")
  @@index([householdId])
  @@index([roomId])
  @@index([status])
  @@index([dueDate])
  @@index([parentTaskId])
  @@index([categoryId])
}

model ChoreAssignment {
  id           String        @id @default(uuid())
  choreId      String
  chore        ChoreTemplate @relation(fields: [choreId], references: [id], onDelete: Cascade)
  assignedTo   String
  user         User          @relation(fields: [assignedTo], references: [id], onDelete: Cascade)

  // Assignment Period
  weekStarting DateTime      @db.Date

  // Completion
  isCompleted  Boolean       @default(false)
  completedAt  DateTime?
  photoUrl     String?
  notes        String?

  // Swapping
  swappedWith  String?                        // User ID if chore was swapped
  swapRequested Boolean      @default(false)

  // Timestamps
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("chore_assignments")
  @@unique([choreId, weekStarting, assignedTo])
  @@index([assignedTo])
  @@index([weekStarting])
  @@index([isCompleted])
}

// ============================================
// HOUSE BULLETIN BOARD
// ============================================

enum AnnouncementType {
  INFO
  URGENT
  EVENT
  REMINDER
  POLL
}

model Announcement {
  id          String   @id @default(uuid())
  householdId String
  household   Household @relation(fields: [householdId], references: [id], onDelete: Cascade)
  authorId    String
  author      User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  // Announcement Details
  title       String
  content     String
  type        AnnouncementType @default(INFO)
  isPinned    Boolean  @default(false)
  expiresAt   DateTime?

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  reactions   AnnouncementReaction[]

  @@map("announcements")
  @@index([householdId])
  @@index([authorId])
  @@index([isPinned])
  @@index([type])
}

model AnnouncementReaction {
  id             String   @id @default(uuid())
  announcementId String
  announcement   Announcement @relation(fields: [announcementId], references: [id], onDelete: Cascade)
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Reaction
  emoji          String   // üëç ‚ù§Ô∏è üòÇ üòÆ üò¢ üéâ

  // Timestamp
  createdAt      DateTime @default(now())

  @@map("announcement_reactions")
  @@unique([announcementId, userId, emoji])
  @@index([announcementId])
  @@index([userId])
}

// ============================================
// NOTIFICATIONS (Sprint 5C)
// ============================================

enum NotificationType {
  TASK_ASSIGNED       // You have a new task
  TASK_DUE_SOON      // Task due in 24 hours
  TASK_OVERDUE       // Task is overdue
  TASK_COMPLETED     // Someone completed a task
  CHORE_ROTATION     // New weekly chore rotation
  FAVOR_REQUEST      // Someone requested a favor
  FAVOR_ACCEPTED     // Your favor was accepted
  ACHIEVEMENT        // Achievement unlocked
  LEVEL_UP           // User leveled up
  STREAK_MILESTONE   // Streak milestone reached
  ANNOUNCEMENT       // New household announcement
  SYSTEM             // System notifications
}

enum NotificationPriority {
  LOW        // FYI notifications
  MEDIUM     // Normal importance
  HIGH       // Requires attention
  URGENT     // Immediate action needed
}

model Notification {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Notification Content
  type        NotificationType
  priority    NotificationPriority @default(MEDIUM)
  title       String
  message     String
  icon        String?  @default("üîî")

  // Action & Navigation
  actionUrl   String?  // Frontend route to navigate when clicked
  metadata    Json?    // Additional data (taskId, choreId, etc.)

  // Status
  isRead      Boolean  @default(false)
  readAt      DateTime?

  // Timestamps
  createdAt   DateTime @default(now())
  expiresAt   DateTime? // Auto-delete after this date

  @@map("notifications")
  @@index([userId])
  @@index([isRead])
  @@index([type])
  @@index([createdAt])
  @@index([expiresAt])
}

model NotificationPreference {
  id          String   @id @default(uuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Channel Settings
  enableEmail       Boolean @default(false)
  enablePush        Boolean @default(true)
  enableInApp       Boolean @default(true)

  // Type-Specific Settings (what to get notified about)
  taskAssignments   Boolean @default(true)
  taskReminders     Boolean @default(true)
  taskCompletions   Boolean @default(true)
  choreRotations    Boolean @default(true)
  favorRequests     Boolean @default(true)
  achievements      Boolean @default(true)
  announcements     Boolean @default(true)

  // Quiet Hours
  enableQuietHours  Boolean @default(false)
  quietHoursStart   String? // Format: "22:00"
  quietHoursEnd     String? // Format: "08:00"

  // Digest Settings
  enableDailyDigest Boolean @default(false)
  digestTime        String? @default("09:00")

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("notification_preferences")
}

model PushSubscription {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Web Push Subscription Data
  endpoint    String   @unique
  p256dh      String   // Public key
  auth        String   // Auth secret

  // Device Info
  deviceName  String?  @default("Unknown Device")
  userAgent   String?

  // Status
  isActive    Boolean  @default(true)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lastUsedAt  DateTime @default(now())

  @@map("push_subscriptions")
  @@index([userId])
  @@index([endpoint])
  @@index([isActive])
}

// ============================================
// SPRINT 6: ADVANCED ROOM FEATURES
// ============================================

// Task Category Model - Organize tasks into categories
model TaskCategory {
  id          String   @id @default(uuid())
  householdId String
  household   Household @relation(fields: [householdId], references: [id], onDelete: Cascade)

  // Category Details
  name        String
  description String?
  color       String   @default("#3b82f6") // Hex color for UI
  icon        String   @default("üìã")
  order       Int      @default(0)
  isActive    Boolean  @default(true)

  // Relations
  tasks       ChoreTemplate[]

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("task_categories")
  @@index([householdId])
  @@index([isActive])
}

// Tag Model - Flexible task filtering
model Tag {
  id          String   @id @default(uuid())
  householdId String
  household   Household @relation(fields: [householdId], references: [id], onDelete: Cascade)

  // Tag Details
  name        String
  color       String   @default("#6b7280") // Hex color for UI

  // Relations
  tasks       TaskTag[]

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("tags")
  @@unique([householdId, name])
  @@index([householdId])
}

// Junction table for many-to-many Task-Tag relationship
model TaskTag {
  id     String @id @default(uuid())
  taskId String
  task   ChoreTemplate @relation(fields: [taskId], references: [id], onDelete: Cascade)
  tagId  String
  tag    Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@map("task_tags")
  @@unique([taskId, tagId])
  @@index([taskId])
  @@index([tagId])
}

// Task History Model - Track all task changes for audit log
model TaskHistory {
  id          String   @id @default(uuid())
  taskId      String
  task        ChoreTemplate @relation(fields: [taskId], references: [id], onDelete: Cascade)

  // Actor
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Change Details
  action      TaskHistoryAction // CREATED, UPDATED, DELETED, STATUS_CHANGED, ASSIGNED, SCHEDULED, COMPLETED
  field       String?  // Field that was changed (title, dueDate, assignedTo, etc.)
  oldValue    String?  // Previous value (JSON string)
  newValue    String?  // New value (JSON string)
  description String?  // Human-readable description

  // Metadata
  metadata    Json?    // Additional context

  // Timestamps
  createdAt   DateTime @default(now())

  @@map("task_history")
  @@index([taskId])
  @@index([userId])
  @@index([createdAt])
}

enum TaskHistoryAction {
  CREATED
  UPDATED
  DELETED
  STATUS_CHANGED
  ASSIGNED
  SCHEDULED
  COMPLETED
  UNCOMPLETED
}

// Room Template Model - Predefined room configurations
model RoomTemplate {
  id          String   @id @default(uuid())

  // Template Details
  name        String
  description String?
  roomType    RoomType
  icon        String   @default("üè†")

  // Visibility
  isSystemTemplate Boolean @default(false) // Created by system vs user
  isPublic    Boolean  @default(false) // Available to all households
  createdBy   String?
  creator     User?    @relation(fields: [createdBy], references: [id], onDelete: SetNull)

  // Template Content (JSON containing room config + tasks)
  config      Json     // { room: {...}, tasks: [...] }

  // Usage Stats
  useCount    Int      @default(0)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("room_templates")
  @@index([roomType])
  @@index([isSystemTemplate])
  @@index([isPublic])
  @@index([createdBy])
}

// Bulk Operation Model - Track multi-task operations
model BulkOperation {
  id          String   @id @default(uuid())
  householdId String
  household   Household @relation(fields: [householdId], references: [id], onDelete: Cascade)

  // Operator
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Operation Details
  operation   BulkOperationType // UPDATE_STATUS, DELETE, ASSIGN, RESCHEDULE, TAG
  targetCount Int      // Number of tasks affected
  criteria    Json     // Selection criteria (filters used)
  changes     Json     // Changes applied

  // Status
  status      BulkOperationStatus @default(PENDING)
  progress    Int      @default(0) // Percentage complete
  errors      Json?    // Any errors that occurred

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  completedAt DateTime?

  @@map("bulk_operations")
  @@index([householdId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

enum BulkOperationType {
  UPDATE_STATUS
  DELETE
  ASSIGN
  RESCHEDULE
  TAG
  CATEGORY_CHANGE
}

enum BulkOperationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  FAILED
  CANCELLED
}
